<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Critocracy</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!-- Start Screen -->
    <div id="start-screen" class="screen active">
        <div class="start-content">
            <h1>Critical Thinking By Traci Dirom</h1>
            <button id="start-game-btn" class="animate-fadeIn">Start Game</button>
        </div>
    </div>

    <!-- Player Count Screen -->
    <div id="player-count-screen" class="screen">
        <div class="screen-content">
            <h2>Select Players</h2>
            <div class="input-group">
                <label for="total-player-count">Total Players: 6</label>
                <select id="total-player-count" name="total-players">
                    <option value="6" selected>6</option>
                </select>
            </div>
            <div class="input-group">
                <label for="human-player-count">Human Players (1-6):</label>
                <select id="human-player-count" name="human-players">
                    <option value="1" selected>1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                </select>
            </div>
            <p class="player-info-text">AI players will fill remaining slots</p>
            <button id="player-count-confirm" class="confirm-btn">Confirm Player Setup</button>
        </div>
    </div>

    <!-- Role Selection Screen -->
    <div id="role-selection-screen" class="screen hidden">
        <h2>Select Roles</h2>
        <div id="role-selection-container" class="grid-container">
            <!-- Artist Card -->
            <div class="role-card grid-item">
                <h2>Salvidor Dali The Artist</h2>
                <h3>A Brilliant Nutjob And Entertaining Loose Cannon</h3>
                <div class="role-card-body">
                    <div class="role-card-text">
                        <p><strong>Starting Resources:</strong>14 Influence, 8 Knowledge, 0 Money</p>
                        <p><strong>Special Ability:</strong> Cannot be forced to change paths</p>
                        <p><strong>Opposition:</strong> Entrepreneur</p>
                    </div>
                    <div class="token-image role-card-image">
                        <img src="assets/tokens/A.png" alt="Artist">
                    </div>
                </div>
                <div class="role-card-footer">
                    <button class="role-select" data-role="ARTIST">Select</button>
                </div>
            </div>

            <!-- Historian Card -->
            <div class="role-card grid-item">
                <h2>Suetonius The Historian</h2>
                <h3>Rome's Greatest Gossip....err Historian</h3>
                <div class="role-card-body">
                    <div class="role-card-text">
                        <p><strong>Starting Resources:</strong> 14 Knowledge, 8 Memory, 0 Influence</p>
                        <p><strong>Special Ability:</strong> Cannot have knowledge stolen</p>
                        <p><strong>Opposition:</strong> Politician</p>
                    </div>
                    <div class="token-image">
                        <img src="assets/tokens/H.png" alt="Historian">
                    </div>
                </div>
                <div class="role-card-footer">
                    <button class="role-select" data-role="HISTORIAN">Select</button>
                </div>
            </div>

            <!-- Colonialist Card -->
            <div class="role-card grid-item">
                <h2>Jacques Cartier The Colonialist</h2>
                <h3>For The Glory Of The Empire!<sub>...but to the detriment of everyone else</sub></h3>
                <div class="role-card-body">
                    <div class="role-card-text">
                        <p><strong>Starting Resources:</strong> 14 Money, 8 Influence, 0 Knowledge</p>
                        <p><strong>Special Ability:</strong> Cannot have influence stolen</p>
                        <p><strong>Opposition:</strong> Revolutionary</p>
                    </div>
                    <div class="token-image">
                        <img src="assets/tokens/C.png" alt="Colonialist">
                    </div>
                </div>
                <div class="role-card-footer">
                    <button class="role-select" data-role="COLONIALIST">Select</button>
                </div>
            </div>

            <!-- Revolutionary Card -->
            <div class="role-card grid-item">
                <h2>Audra Lorde The Revolutionary</h2>
                <h3>The Quietest Revolutionary That Ever There Was</h3>
                <div class="role-card-body">
                    <div class="role-card-text">
                        <p><strong>Starting Resources:</strong> 14 Knowledge, 8 Influence, 0 Money</p>
                        <p><strong>Special Ability:</strong> Ignores 1 sabatoge per game</p>
                        <p><strong>Opposition:</strong> Entrepreneur</p>
                    </div>
                    <div class="token-image">
                        <img src="assets/tokens/R.png" alt="Revolutionary">
                    </div>
                </div>
                <div class="role-card-footer">
                    <button class="role-select" data-role="REVOLUTIONARY">Select</button>
                </div>
            </div>

            <!-- Politician Card -->
            <div class="role-card grid-item">
                <h2>Winston Churchill The Politician</h2>
                <h3>The Politician With A Plan...Unless You Are Irish</h3>
                <div class="role-card-body">
                    <div class="role-card-text">
                        <p><strong>Starting Resources:</strong> 14 Influence, 8 Money, 0 Knowledge</p>
                        <p><strong>Special Ability:</strong> Money cannot be stolen from</p>
                        <p><strong>Opposition:</strong> Historian</p>
                    </div>
                    <div class="token-image">
                        <img src="assets/tokens/P.png" alt="Politician">
                    </div>
                </div>
                <div class="role-card-footer">
                    <button class="role-select" data-role="POLITICIAN">Select</button>
                </div>
            </div>

            <!-- Entrepreneur Card -->
            <div class="role-card grid-item">
                <h2>Regina Basilier The Entrepreneur</h2>
                <h3>Making Bank Before It Was Even Legal, Legit</h3>
                <div class="role-card-body">
                    <div class="role-card-text">
                        <p><strong>Starting Resources:</strong> 14 Money, 8 Knowledge, 0 Influence</p>
                        <p><strong>Special Ability:</strong> Never has to miss a turn</p>
                        <p><strong>Opposition:</strong> Artist</p>
                    </div>
                    <div class="token-image">
                        <img src="assets/tokens/E.png" alt="Entrepreneur">
                    </div>
                </div>
                <div class="role-card-footer">
                    <button class="role-select" data-role="ENTREPRENEUR">Select</button>
                </div>
            </div>
        </div>
        <div class="confirm-button-container">
            <button id="role-confirm" class="confirm-btn">Confirm Role</button>
        </div>
    </div>

    <!-- Turn Order Screen -->
    <div id="turn-order-screen" class="screen">
        <div class="screen-content">
            <h2>Roll for Turn Order</h2>
            <div id="turn-order-container"></div>
            <button id="roll-turn-order-btn" class="action-btn">Roll Dice</button>
            <div id="turn-order-results"></div>
        </div>
    </div>

    <!-- Game Board Screen -->
    <div id="game-board-screen" class="screen">
        <div id="board-container" class="game-board-container">
            <canvas id="board-canvas"></canvas>
            <div id="ui-container">
                <div id="player-info-panel">
                    <h2>Current Player</h2>
                    <div id="current-player-name">-</div>
                    <div id="resources">
                        <div>Money: <span id="resource-money">0</span></div>
                        <div>Knowledge: <span id="resource-knowledge">0</span></div>
                        <div>Influence: <span id="resource-influence">0</span></div>
                    </div>
                </div>
                <div id="message-log"></div>
                <div id="controls">
                    <button id="roll-dice-btn">Roll Dice</button>
                    <button id="end-turn-btn" disabled>End Turn</button>
                    <button id="use-ability-btn" disabled>Use Ability</button>
                </div>
            </div>
        </div>
        
        <!-- Required popups -->
        <div id="dice-display" class="popup" style="display: none;">
            <div id="dice-face"></div>
            <div id="dice-roll"></div>
        </div>
        
        <div id="card-popup" class="popup" style="display: none;">
            <h3 id="card-title">Card Title</h3>
            <p id="card-description">Card description goes here.</p>
            <div id="card-effects"></div>
            <button id="show-card-details-btn">Show Details</button>
            <button id="close-card-btn">Close</button>
        </div>
        
        <div id="trade-prompt-modal" class="popup" style="display: none;">
            <h3>Trade Offer</h3>
            <p id="trade-prompt-details"></p>
            <div id="trade-player-resources"></div>
            <div class="trade-buttons">
                <button id="trade-accept-btn">Accept</button>
                <button id="trade-reject-btn">Reject</button>
            </div>
        </div>
        
        <div id="target-selection-modal" class="popup" style="display: none;">
            <h3>Select Target</h3>
            <p id="target-selection-description"></p>
            <div id="target-player-list"></div>
            <button id="cancel-target-btn">Cancel</button>
        </div>
    </div>
    
    <!-- End Game Screen -->
    <div id="end-game-screen" class="screen">
        <div id="end-game-container">
            <h2>Game Over</h2>
            <div id="winner-display"></div>
            <div id="final-scores"></div>
            <button id="new-game-btn">New Game</button>
        </div>
    </div>

    <script type="module" src="js/main.js"></script>

    <!-- Game Scripts -->
    <!-- Use type="module" for all scripts to enable ES6 modules -->
    <script type="module" src="assets/Cards/Specialeventcards.js"></script>
    <script type="module" src="js/board-data.js"></script>
    <script type="module" src="js/logging.js"></script>
    <script type="module" src="js/players.js"></script>
    <script type="module" src="js/cards.js"></script>
    <script type="module" src="js/board.js"></script>
    <script type="module" src="js/animations.js"></script>
    <script type="module" src="js/ui.js"></script>
    <script type="module" src="js/game.js"></script>
    <script type="module">
        // Import the showScreen function
        import { showScreen } from './js/ui.js';
        
        // Fix for role selection buttons with specific focus on event capture
        document.addEventListener('DOMContentLoaded', function() {
            // Wait a short time to ensure all elements are fully rendered
            setTimeout(function() {
                // Fix role select buttons with proper event handling
                const roleButtons = document.querySelectorAll('.role-select');
                roleButtons.forEach(button => {
                    // Remove any existing event listeners
                    const newBtn = button.cloneNode(true);
                    button.parentNode.replaceChild(newBtn, button);
                    
                    // Add new event listener with capture and prevent bubbling
                    newBtn.addEventListener('click', function(e) {
                        e.stopPropagation();
                        e.preventDefault();
                        
                        // Clear any previous selections
                        document.querySelectorAll('.grid-item').forEach(item => {
                            item.classList.remove('selected');
                        });
                        
                        // Find this button's card and select it
                        let parentCard = this.closest('.grid-item');
                        parentCard.classList.add('selected');
                        console.log('Role selected:', this.getAttribute('data-role'));
                    }, true); // Use capture phase
                });
                
                // Also make entire cards clickable to improve UX
                const roleCards = document.querySelectorAll('.grid-item');
                roleCards.forEach(card => {
                    // Remove any existing handlers
                    const newCard = card.cloneNode(true);
                    card.parentNode.replaceChild(newCard, card);
                    
                    // Add click handler to the card
                    newCard.addEventListener('click', function(e) {
                        // Only handle click if it's directly on the card (not on button)
                        if (e.target.closest('.role-select')) {
                            return; // Let the button handler deal with it
                        }
                        
                        // Clear any previous selections
                        document.querySelectorAll('.grid-item').forEach(item => {
                            item.classList.remove('selected');
                        });
                        
                        // Select this card
                        this.classList.add('selected');
                        console.log('Card selected:', this.querySelector('.role-select').getAttribute('data-role'));
                    });
                    
                    // Re-add button handlers since we cloned the card
                    const button = newCard.querySelector('.role-select');
                    button.addEventListener('click', function(e) {
                        e.stopPropagation();
                        e.preventDefault();
                        
                        // Clear any previous selections
                        document.querySelectorAll('.grid-item').forEach(item => {
                            item.classList.remove('selected');
                        });
                        
                        // Find this button's card and select it
                        let parentCard = this.closest('.grid-item');
                        parentCard.classList.add('selected');
                        console.log('Role selected:', this.getAttribute('data-role'));
                    }, true);
                });
                
                // Fix confirm button
                const confirmButton = document.getElementById('role-confirm');
                if (confirmButton) {
                    confirmButton.addEventListener('click', function() {
                        const selectedRole = document.querySelector('.grid-item.selected');
                        if (!selectedRole) {
                            alert('Please select a role first!');
                            return;
                        }
                        
                        const roleData = selectedRole.querySelector('.role-select').getAttribute('data-role');
                        console.log('Confirmed role:', roleData);
                        
                        // Import required functions
                        import('./js/game.js').then(gameModule => {
                            // Create player configurations with the selected role
                            const playerConfigs = [{
                                name: "Player 1", 
                                role: roleData,
                                isHuman: true
                            }];
                            
                            // Initialize the game with the player configuration
                            gameModule.initializeGame(playerConfigs).then(success => {
                                if (success) {
                                    // Show game board screen if initialization successful
                                    showScreen('game-board-screen');
                                } else {
                                    alert("Failed to start the game. Please try again.");
                                }
                            });
                        });
                    });
                }
            }, 200); // Small delay to ensure elements are fully rendered
        });
    </script>
</body>
</html> 